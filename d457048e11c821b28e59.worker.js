!function(e){function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var r={};n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="/depixel-it/",n(n.s=0)}([function(e,n,r){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function o(e,n){!e&&0!==e||!n&&0!==n||N.default.progress(e,n);var r=N.default.getProgression();O!==r.percent&&(O=r.percent,w({type:"progress",data:r}))}function d(e,n,r){for(var t=new b.default(n*r,n,r),d=0;d<r;d++)for(var i=0;i<n;i++){var a=d*n+i,s={r:e[4*a],g:e[4*a+1],b:e[4*a+2]};t.nodes[a].rgb=s,t.nodes[a].x=i,t.nodes[a].y=d,i<n-1&&(t.addEdge(a,a+1,"right"),d>0&&t.addEdge(a,a-n+1,"upright"),d<r-1&&t.addEdge(a,a+n+1,"downright")),i>0&&(t.addEdge(a,a-1,"left"),d>0&&t.addEdge(a,a-n-1,"upleft"),d<r-1&&t.addEdge(a,a+n-1,"downleft")),d<r-1&&t.addEdge(a,a+n,"down"),d>0&&t.addEdge(a,a-n,"up"),o(0,Math.floor(a/(r*n-1)*100))}return t}function i(e){return{y:Math.ceil(.299*e.r+.587*e.g+.114*e.b),u:Math.ceil(-.168736*e.r+-.331264*e.g+.5*e.b+128),v:Math.ceil(.5*e.r+-.418688*e.g+-.081312*e.b+128)}}function a(e,n){return e.r===n.r&&e.g===n.g&&e.b===n.b}function s(e){for(var n=e.nodes,r=0;r<n.length;++r){for(var t=n[r].edges,d=i(n[r].rgb),a=0;a<t.length;++a){var s=n[t[a].nodeId],u=i(s.rgb);(Math.abs(d.y-u.y)>48/255||Math.abs(d.u-u.u)>7/255||Math.abs(d.v-u.v)>6/255)&&(e.removeEdge(r,t[a].nodeId),--a)}o(1,Math.floor(r/(n.length-1)*100))}}function u(e,n,r,t){var o=e.nodes,d=[],i=[n+"-"+r];for(d.push(n),d.push(r);d.length;){var a=d.pop(),s=o[a].edges;if(2===s.length)for(var u=0;u<s.length;++u){var l=s[u];-1===i.indexOf(a+"-"+l.nodeId)&&-1===i.indexOf(l.nodeId+"-"+a)&&(i.push(a+"-"+l.nodeId),d.push(l.nodeId))}}return i.length}function l(e,n,r,t){var o=e%r,d=Math.floor(e/r),i=n%r,a=Math.floor(n/r),s=-5+Math.min(o,i),u=-5+Math.min(d,a);return{xMin:s,yMin:u,xMax:s+8,yMax:u+8}}function f(e,n,r){var t=e.xMin,o=e.yMin,d=e.xMax,i=e.yMax;return n>=t&&n<=d&&r>=o&&r<=i}function g(e,n,r,t,o){var d=[],i=[n,r],a=l(n,r,t,o);for(d.push(n),d.push(r);d.length;)for(var s=d.pop(),u=e.nodes[s].edges,g=0;g<u.length;++g){var h=u[g].nodeId;if(-1===i.indexOf(h)){var c=e.nodes[h];f(a,c.x,c.y)&&(i.push(h),d.push(h))}}return-i.length}function h(e,n,r,t){var o=e.nodes;return 1===o[n].edges.length||1===o[r].edges.length?5:0}function c(e,n,r,t,o){var d=0;return d+=u(e,n,r,t),d+=g(e,n,r,t,o),d+=h(e,n,r,t)}function p(e,n,r,t){var o=c(e,n,n+r+1,r,t),d=c(e,n+1,n+r,r,t);return o>d?{from:n+1,to:n+r}:o<d?{from:n,to:n+r+1}:null}function v(e,n,r){for(var t=e.nodes,d=0;d<t.length;++d){if(e.hasEdge(d,d+1)&&e.hasEdge(d,d+n)&&e.hasEdge(d,d+n+1)&&e.hasEdge(d+1,d+n)&&e.hasEdge(d+1,d+n+1)&&e.hasEdge(d+n,d+n+1))e.removeEdge(d,d+n+1),e.removeEdge(d+1,d+n);else if(!e.hasEdge(d,d+1)&&!e.hasEdge(d,d+n)&&e.hasEdge(d,d+n+1)&&e.hasEdge(d+1,d+n)&&!e.hasEdge(d+1,d+n+1)&&!e.hasEdge(d+n,d+n+1)){var i=p(e,d,n,r);i?e.removeEdge(i.from,i.to):(e.removeEdge(d,d+n+1),e.removeEdge(d+1,d+n))}o(2,Math.floor(d/(t.length-1)*100))}}function y(e,n,r){var t=new b.default((n+1)*(r+1),n+1,r+1),d=e.nodes;t.makeGrid(n,r);for(var i=0;i<d.length;++i){var s=d[i],u=s.edges,l=s.x,f=s.y,g=s.rgb,h=s.id;if(!(0===l&&0===f||0===l&&f===r-1||l===n-1&&0===f||l===n-1&&f===r-1)){for(var c=0;c<u.length;++c){var p=u[c],v=d[p.nodeId];if(l!==v.x&&f!==v.y){var y=Math.max(v.x,l),x=Math.max(v.y,f),E=v.x-l,m=v.y-f,M=e.findNode(v.x,f),N=null,w=null,O=null,k=null,_=null,I=null,C=null;a(g,M.rgb)||(N=[y,x-m],w=[y,x-.5*m],O=[y+.25*E,x-.25*m],e.removeCorner(M.id,y,x),e.addCorner(M.id,O[0],O[1]),e.addCorner(h,O[0],O[1]),k=t.findNode(w[0],w[1]),_=t.findNode(O[0],O[1]),I=t.findNode(y,x),k?t.removeEdge(k.id,I.id):(C=t.findNode(N[0],N[1]),t.removeEdge(C.id,I.id),k=t.addNode(w[0],w[1]),t.addEdge(C.id,k.id)),_||(_=t.addNode(O[0],O[1])),t.addEdge(k.id,_.id),t.addEdge(_.id,I.id)),M=e.findNode(l,v.y),a(g,M.rgb)||(N=[y-E,x],w=[y-.5*E,x],O=[y-.25*E,x+.25*m],e.removeCorner(M.id,y,x),e.addCorner(M.id,O[0],O[1]),e.addCorner(h,O[0],O[1]),k=t.findNode(w[0],w[1]),_=t.findNode(O[0],O[1]),I=t.findNode(y,x),k?t.removeEdge(k.id,I.id):(C=t.findNode(N[0],N[1]),t.removeEdge(C.id,I.id),k=t.addNode(w[0],w[1]),t.addEdge(C.id,k.id)),_||(_=t.addNode(O[0],O[1])),t.addEdge(k.id,_.id),t.addEdge(_.id,I.id))}}o(3,Math.floor(i/(d.length-1)*100))}}for(var P=[],S=0;S<t.nodes.length;++S){var j=t.nodes[S],u=j.edges,l=j.x,f=j.y,h=j.id;0===l&&0===f||0===l&&f===r||l===n&&0===f||l===n&&f===r||(2===u.length&&t.addEdge(u[0].nodeId,u[1].nodeId),u.length<=2&&P.push(h))}for(var z=0;z<P.length;++z)t.removeNode(P[z]);for(var J=0;J<d.length;++J)for(var G=JSON.parse(JSON.stringify(d[J].corners)),T=0;T<G.length;++T)t.findNode(G[T].x,G[T].y)||e.removeCorner(J,G[T].x,G[T].y);return t}function x(e,n,r){var t=d(e,n,r);w({type:"step",data:{type:"initial",graph:t.serialize()}}),s(t),w({type:"step",data:{type:"initial",graph:t.serialize()}}),v(t,n,r),w({type:"step",data:{type:"initial",graph:t.serialize()}});var o=y(t,n,r);w({type:"step",data:{type:"initial",graph:t.serialize()}}),w({type:"step",data:{type:"reshaped",graph:o.serialize()}}),w({type:"step",data:{type:"shapes",graph:t.serialize()}});for(var i=t.shapes(),a=0;a<i.length;++a)i[a].dump()}function E(e){var n=e.data.width,r=e.data.height,t=e.data.data;console.log("Message received from main script."),console.log(e.data),O=0,N.default.reset(),x(t,n,r),N.default.done(),o()}var m=r(1),b=t(m),M=r(4),N=t(M),w=postMessage,O=0;onmessage=E},function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){for(var r=0;r<e.length;++r)if(e[r].nodeId===n)return r;return-1}function d(e,n){for(var r=0;r<e.length;++r)if(e[r].id===n)return r;return-1}function i(e,n,r){for(var t=0;t<e.length;++t)if(e[t].x===n&&e[t].y===r)return t;return-1}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),s=r(2),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=0,f=function(){function e(n,r,o){t(this,e),this.id=++l,this.nodes=new Array(n),this.width=r,this.height=o;for(var d=0;d<this.nodes.length;++d){var i=d%r,a=Math.floor(d/r);this.nodes[d]={id:d,edges:[],rgb:null,x:-1,y:-1,corners:[{x:i,y:a}]},i<r&&this.nodes[d].corners.push({x:i+1,y:a}),a<o&&this.nodes[d].corners.push({x:i,y:a+1}),i<r&&a<o&&this.nodes[d].corners.push({x:i+1,y:a+1})}}return a(e,[{key:"makeGrid",value:function(e,n){for(var r=this.nodes,t=0;t<r.length;++t){var o=t%(e+1),d=Math.floor(t/(e+1));r[t].x=o,r[t].y=d,r[t].corners=[],o<e&&this.addEdge(t,t+1,"right"),d<n&&this.addEdge(t,t+(e+1),"down")}}},{key:"addNode",value:function(e,n){var r=this.findNode(e,n);return r||(r={id:this.nodes.length,edges:[],rgb:null,x:e,y:n,corners:[]},this.nodes.push(r)),r}},{key:"removeNode",value:function(e){var n=d(this.nodes,e);if(-1!==n){for(var r=this.nodes[n];r.edges.length;)this.removeEdge(e,r.edges[0].nodeId);this.nodes.splice(n,1)}}},{key:"findNode",value:function(e,n){for(var r=0;r<this.nodes.length;++r)if(this.nodes[r].x===e&&this.nodes[r].y===n)return this.nodes[r];return null}},{key:"getNode",value:function(e){for(var n=0;n<this.nodes.length;++n)if(this.nodes[n].id===e)return this.nodes[n];return null}},{key:"addEdge",value:function(e,n,r,t){var d=this.getNode(e),i=this.getNode(n);if(d&&-1===o(d.edges,n)&&d.edges.push({nodeId:n,dir:r,data:t}),i&&-1===o(i.edges,e)){i.edges.push({nodeId:e,dir:function(e){return"up"===e?"down":"down"===e?"up":"left"===e?"right":"right"===e?"left":"upright"===e?"downleft":"upleft"===e?"downright":"downleft"===e?"upright":"downright"===e?"upleft":void 0}(r),data:t})}}},{key:"removeEdge",value:function(e,n){var r=this.getNode(e),t=this.getNode(n);if(r){var d=o(r.edges,n);-1!==d&&r.edges.splice(d,1)}if(t){var i=o(t.edges,e);-1!==i&&t.edges.splice(i,1)}}},{key:"hasEdge",value:function(e,n){return-1!==o(this.getNode(e).edges,n)}},{key:"removeCorner",value:function(e,n,r){var t=this.getNode(e);if(t){var o=i(t.corners,n,r);-1!==o&&t.corners.splice(o,1)}}},{key:"addCorner",value:function(e,n,r){var t=this.getNode(e);t&&-1===i(t.corners,n,r)&&t.corners.push({x:n,y:r})}},{key:"shapes",value:function(){for(var e=this.nodes,n=[],r=[],t=0;t<e.length;++t){var o=e[t];if(-1===r.indexOf(o.id)){var d=new u.default,i=[o.id];for(r.push(o.id),d.addPoint(o.x,o.y,o.rgb,o.corners);i.length;)for(var a=i.pop(),s=e[a],l=0;l<s.edges.length;++l){var f=s.edges[l].nodeId,g=e[f];-1===r.indexOf(f)&&(i.push(f),r.push(f),d.addPoint(g.x,g.y,g.rgb,g.corners))}n.push(d)}}return n}},{key:"serialize",value:function(){return JSON.stringify({nodes:this.nodes,width:this.width,height:this.height})}}],[{key:"unserialize",value:function(n){var r=JSON.parse(n),t=new e(r.nodes.length,r.width,r.height);return t.nodes=r.nodes,t}}]),e}();n.default=f},function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),d=r(3),i=function(e){return e&&e.__esModule?e:{default:e}}(d),a=function(){function e(){t(this,e),this.points=[]}return o(e,[{key:"addPoint",value:function(e,n,r,t){var o=new i.default(e,n,r,t),d=this.points[0];!d||d.x<=o.x?this.points.push(o):this.points.unshift(o)}},{key:"computeConvexHull",value:function(){}},{key:"dump",value:function(){console.log("Shape of "+this.points.length+" points.");for(var e=0;e<this.points.length;++e){var n=this.points[e];console.log("("+n.x+", "+n.y+") rgb: "+JSON.stringify(n.rgb)+" corners: "+JSON.stringify(n.corners))}}}]),e}();n.default=a},function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n,r,t){var o=Math.atan2(r.y-n,r.x-e),d=Math.atan2(t.y-n,t.x-e);return console.log("angleA ("+e+", "+n+") -> ("+r.x+", "+r.y+"): "+o+" | angleB ("+e+", "+n+") -> ("+t.x+", "+t.y+"): "+d),o<d?-1:o>d?1:0}Object.defineProperty(n,"__esModule",{value:!0});var d=function e(n,r,d,i){t(this,e),this.x=n,this.y=r,this.rgb=d,console.log(" in => "+JSON.stringify(i)),this.corners=i?i.sort(o.bind(null,n+.5,r+.5)):[],console.log(" out => "+JSON.stringify(this.corners))};n.default=d},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=[{title:"Generating similarity graph",progress:0},{title:"Removing dissimilar connected pixels",progress:0},{title:"Resolving ambiguous diagonals",progress:0},{title:"Computing reshaped graph",progress:0}],o=!1,d={};d.reset=function(){for(var e=0;e<t.length;++e)t[e].progress=0;o=!1},d.progress=function(e,n){t[e]&&(t[e].progress=n)},d.done=function(){for(var e=0;e<t.length;++e)t[e].progress=100;o=!0},d.getProgression=function(){for(var e=0,n=null,r=0;r<t.length;++r)e+=t[r].progress,n||100===t[r].progress||(n=t[r].title);var d=Math.floor(e/t.length);return{title:100===d?"":n||t[0].title,percent:d,complete:o}},n.default=d}]);
//# sourceMappingURL=d457048e11c821b28e59.worker.js.map